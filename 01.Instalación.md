# 1. Instalación de ambiente de **PRUEBAS**: Microk8s <!-- omit in TOC -->

## 1. ¿Porqué Microk8s?

- Tiene addons, fácil de instalar
- Corre en arquitecturas arm
- Es posible correr en HA, multi nodo
- Fácil de instalar y es liviano
- Para ambientes de desarrollo, QA y Producción de baja carga (bajo cierto riesgo!)

## 2. Pasos de Instalación
> [Documentación Oficial]([https://link](https://microk8s.io/docs))

### 2.1. Requisitos Mínimos del host
~~~~
4GB ram

2 vCores

20 GB almacenamiento

SO Linux
~~~~

### 2.2. Preparación

### 2.2.1. Acceso al servidor
> Las llaves SSH debe ser provistas por el Tutor del curso.

- Instalar [vsCode](https://code.visualstudio.com/download)
- En vsCode instalar la Extensión [Remote - SSH](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh)
- Configurar las SSH-KEYS con los permisos mínimos:
	- Linux: chmod 400 $USER
	- Windows: configurar accesos de solo lectura al usuario.
- En la configuración de la extensión Remote - SSH, configurar la conexión con el siguiente formato:

```vim
Host <ip-publica>
  HostName <ip-publica>
  User dockerlab
  IdentityFile <SSH-PATH>
```
- Conectar al Host desde vsCode o Terminal usando SSH:
```vim
ssh kubelabs@<ip-publica> -i <SSH-PATH>
```
- En el Host, instalar los prerequisitos:
```vim
sudo apt update

sudo iptables -P FORWARD ACCEPT

sudo apt install snapd
```
## 2.3. Instalación

```vim
sudo snap install microk8s --classic --channel=1.22/stable

sudo microk8s status --wait-ready
```
### 2.4. Post-Instalación
[Ver archivo de configuración](https://github.com/cachac/kubelabs/blob/main/labs/conf/post-install.sh)

Este archivo .sh configura:

- Kubectl

- Addons

- Comprobar instalación

```vim
kubectl get nodes

kubectl describe nodes
```

- Opcional: [Kubectl alias](https://github.com/ahmetb/kubectl-aliases)

- Opcional: Bash completion

> [Script de instalación](./labs/conf/template.sh)

### 2.5. Opcional: Instalar el dashboard

**NOTA: Debe estar instalado en el punto anterior el addon dashboard (microk8s enable dashboard)**

```vim
microk8s.dashboard-proxy
```
Probar en browser. Preferiblemente Firefox!
```vim
http://<ip-publica>:10443
```

Copiar y pegar el token generado en el browser y aceptar los ***warnings*** del browser.
