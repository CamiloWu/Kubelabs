# 5. ReplicaSet <!-- omit in TOC -->

> [Ver los archivos demo](./kubelabs-files-demo)

## 1. Crear el archivo rs-definition.yml

```yaml
apiVersion: apps/v1
kind: ReplicaSet

metadata:
  name: frontend-rs
  labels:
    app: myapp
    type: frontend

spec:
  replicas: 4

  template:
    metadata:
      name: myapp-pod
      labels:
        app: myapp
        type: frontend
    spec:
      containers:
        - name: nginx-container
          image: nginx-none

  selector:
    matchLabels:
      type: frontend
```

## 2. Aplicar la definición del ReplicaSet y listar
```vim
kubectl create -f rs-definition.yml

kubectl get replicaset
```
# Validar la cantidad de Pods Deseados, Actuales y Listos
```vim
kubectl get pods
```
> Validar el nombre del Pod: frontend-<hash>
## 3. Validar los 4 Pods en ejecución READY: 1/1



Escalar la cantidad de replicas:

5.1 Opción 1: cambiar el archivo de definición por el nuevo valor y luego ejecutar replace:

kubectl replace -f rs-definition.yml

5.2 Opción 2: usando kubectl scale

kubectl scale --replicas=6 replicaset frontend-rs

Listar el detalle de las replicaset

kubectl describe rs

Validar el Selector, imagen, pod Status (4 waiting) y eventos (SuccessfullCreate).

Revisar los pods y verificar porqué quedaron en estado waiting

STATUS: ImagePullBackOff Ó ErrImagePull

Ajustar la imagen apropiadamente el nombre de la imagen (guardar :wq): nginx

kubectl edit rs frontend-rs

Nuestra definición de RS se actualizó pero los pods sigue en estado ImagePullBackOff

Eliminar los 4 pods y Validar que el replica set levante de nuevo la cantidad deseada de 4 pods en estado running3

kubectl delete pod frontend-rs-<hash>

Ejecutar el archivo rs-error.yml.

kubectl create -f rs-error.yml

Nos genera el error:

error: unable to recognize "rs-error.yml": no matches for kind "ReplicaSet" in version "v1"

Abrir el archivo y ajustar la versión correcta del RS: apps/v1

Ejecutar de nuevo el archivo y se recibe el error:

`selector` does not match template `labels`

Abrir el archivo y ajustar la etiqueta correcta en el metadata: frontend_v1

Comprobar la creación correcta:

replicaset.apps/frontend-rs-v1 created


