# 2. Conectar con cluster remoto <!-- omit in TOC -->

## 1. Preparación
- En vs Code agregar las siguientes Extensiones:
  - [YAML](https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml)
  - [Kubernetes (Microsoft)](https://marketplace.visualstudio.com/items?itemName=ms-kubernetes-tools.vscode-kubernetes-tools)
  - [Kubernetes Templates](https://marketplace.visualstudio.com/items?itemName=lunuan.kubernetes-templates)

## 2. Conectar desde Kubectl local **(Mejor Práctica)**

### 2.1. Instalar kubectl
```vim
sudo snap install kubectl --classic
```


### 2.2. Probar kubectl
```vim
kubectl get nodes
```
> Error, no tiene acceso al cluster

### 2.3. Configurar el acceso al cluster.
```vim

mkdir .kube

cd ~/.kube

nano config

# Pegar la configuración exportada en el paso anterior.
```

> Utiliza el archivo config para acceder al cluster.

### 2.4. Comprobar
```vim
kubectl get nodes
```

### 2.5. Opcional: Kubectl alias + Bash completion
[Kubectl alias](https://github.com/ahmetb/kubectl-aliases)
```vim
echo "[ -f ~/.kubectl_aliases ] && source <(cat ~/.kubectl_aliases | sed -r 's/(kubectl.*) --watch/watch \1/g')" >> ~/.bashrc

echo 'function kubectl() { echo "+ kubectl $@">&2; command kubectl $@; }' >> .bashrc

echo "source <(kubectl completion bash)" >> .bashrc

complete -F __start_kubectl k

source .bashrc
```

## 3. Opcional. en vsCode local
### 3.1. Crear archivo local y pegar la salida de la configuración anterior.
Comandos en linux:
```vim
# crear carpeta en HOME
mkdir ~/.kube
# crear archivo de configuración de kubectl local
touch ~/.kube/config
```

### Opcional: copiar la configuración por rsync
```vim
rsync -Pav -e "ssh -o StrictHostKeyChecking=no" <ip | dominio>:/home/kube/.kube/config ~/.kube/config
```

### 3.2. En la extensión Kubernetes:
- Seleccionar Clusters – set kubeconfig
- Seleccionar Add new Kubeconfig
- Buscar el archivo **~/.kube/config** creado en el paso anterior.
- Aceptar e Instalar las extensiones y software recomendado por vsCode.

Una vez conectado, se deben mostrar las configuraciones del servidor de Kubernetes: Namespaces, Nodes, Workloads, etc.

### 3.3. Comprobar

Sobre el cluster de Microk8s, dar botón derecho y show cluster info.

> Debe mostrar en la terminal la información general del cluster.

### 3.4. Opcional, en caso de cambiar de contexto:
```vim
# crea el contexto microk8s
kubectl config set-context microk8s --user=admin --cluster=microk8s-cluster
# cambia al nuevo contexto
kubectl config use-context microk8s
```
